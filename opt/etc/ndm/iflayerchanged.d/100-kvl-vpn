#!/bin/sh
# ------------------------------------------------------------------------------------------
#
# 	ПАКЕТ КВАС ЛАЙТ
#
# ------------------------------------------------------------------------------------------
#
# ------------------------------------------------------------------------------
#	Разработчик: carIod
#	Дата создания: 10/06/2025
#	Лицензия: Apache License 2.0
#   github: https://github.com/carIod/kvl
#	На основе https://github.com/qzeleza/kvas используется на условиях лицензии Apache 2.0.
# ------------------------------------------------------------------------------
[ "${1}" != "hook" ] && exit 0
[ -f /tmp/kvl_config.sh ] || exit 0   # данный файл появляется только после инициализации программы, поэтому исполнять скрипт до этого момента бесполезно
# Подключаем библиотеку с функциями обработки ndm
# shellcheck source=opt\bin\libs\route.sh
. /opt/apps/kvl/bin/libs/route.sh

#Действия для всех остальных подключений
cli_inface="$(get_config_value "INFACE_CLI")"
if [ "${id}" = "${cli_inface}" ]; then
	case "${layer}-${level}" in
		"ctrl-disabled" )
			log "Соединение ${id} было прервано"
		;;
		"ctrl-running" )
			log "Соединение ${id} возобновленно. востанавливаем таблицы маршрутизации"
			# так как это стандартный интерфейс Keenetica он уничтожает все ссылки на интерфейс в таблице маршрутизации. при его подключении необходимо востановить
			ip4_route__add_table &> /dev/null
		;;
	esac
fi

