#!/bin/sh
# ------------------------------------------------------------------------------------------
#
# 	ПАКЕТ КВАС ЛАЙТ
#
# ------------------------------------------------------------------------------------------
#
# ------------------------------------------------------------------------------
#	Разработчик: carIod
#	Дата создания: 10/06/2025
#	Лицензия: Apache License 2.0
#   github: https://github.com/carIod/kvas_light
#	На основе https://github.com/qzeleza/kvas используется на условиях лицензии Apache 2.0.
# ------------------------------------------------------------------------------
[ "${1}" != "hook" ] && exit 0
[ -f /tmp/kvl_config.sh ] || exit 0   # данный файл появляется только после инициализации программы, поэтому исполнять скрипт до этого момента бесполезно
# shellcheck source=opt\bin\libs\route.sh
. /opt/apps/kvl/bin/libs/route.sh
#	Действия для всех остальных подключений
if [ "$id" = "$INFACE_CLI" ]; then
	case "${connected}-${link}-${up}" in
		"no-down-down" )
			log "Соединение ${id} было отключено"
		;;
		"yes-up-up" )
			log "Соединение ${id} возобновленно. востанавливаем таблицы маршрутизации"
			# так как Keenetic уничтожает все ссылки на интерфейс при отключении его, то при подключении нужно востановить
			ip4_route__add_table &> /dev/null
		;;
	esac
fi
